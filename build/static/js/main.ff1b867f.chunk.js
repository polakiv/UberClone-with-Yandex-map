(this["webpackJsonpuberclone-app"]=this["webpackJsonpuberclone-app"]||[]).push([[0],{136:function(e,t,a){},138:function(e,t,a){},148:function(e,t,a){},150:function(e,t,a){},156:function(e,t,a){},157:function(e,t,a){},158:function(e,t,a){},159:function(e,t,a){},160:function(e,t,a){},161:function(e,t,a){},179:function(e,t,a){"use strict";a.r(t);var n=a(0),c=a.n(n),r=a(13),o=a.n(r),s=(a(136),a(11)),i=a(5),l=a(12),u=a.n(l),d=a(17),h=a(246),j=a(212),m=a(213),g=a(215),b=a(216),f=(a(138),a(39)),p=a(214),O=a(37),v=a(40);function x(){if(window.innerHeight>768&&window.innerWidth>1366){var e=window.innerHeight/window.innerWidth,t=768/1366;return t<e?{width:1366,height:window.innerHeight*(1366/window.innerWidth),transform:"scale(".concat(window.innerWidth/1366,")")}:t>e?{width:window.innerWidth*(768/window.innerHeight),height:768,transform:"scale(".concat(window.innerHeight/768,")")}:{width:1366,height:768,transform:"scale(".concat(window.innerHeight/768,")")}}return{width:window.innerWidth,height:window.innerHeight,transform:"scale(1)"}}var w={user:null,path:"",pathID:"",dispatchMessages:{},audioID:null,roomsData:{},page:x()},y={SET_USER:"SET_USER",SET_MESSAGES:"SET_MESSAGES"},S=function(e,t){var a;switch(t.type){case"set_scale_page":return Object(s.a)(Object(s.a)({},e),{},{page:t.page});case y.SET_USER:return Object(s.a)(Object(s.a)({},e),{},{user:t.user});case"SET_PATH":return Object(s.a)(Object(s.a)({},e),{},{path:t.path});case"set_path_id":return Object(s.a)(Object(s.a)({},e),{},{pathID:t.id});case y.SET_MESSAGES:var n=e.dispatchMessages;if(t.update){if(n[t.id].messages)if(0===n[t.id].messages.length)t.messages.length>0&&(n[t.id]={messages:t.messages,limitReached:n[t.id].limitReached,firstMessageID:n[t.id].firstMessageID,audio:e.pathID===t.id});else if(n[t.id].messages.length>0&&0===t.messages.length)n[t.id]={messages:[],limitReached:!0,firstMessageID:void 0,audio:!1};else{var c,r=n[t.id].messages.length-t.messages.length,o=0!==r;if(r>=0)for(var i=0;i<t.messages.length-2&&(o=t.messages[i].id===n[t.id].messages[r+i+1].id);i++);else for(i=0;i<n[t.id].messages.length-2&&(o=t.messages[i].id===n[t.id].messages[i].id);i++);if(o)c=r>=0?[].concat(Object(O.a)(n[t.id].messages.slice(0,r+1)),Object(O.a)(t.messages)):Object(O.a)(t.messages),n[t.id]={messages:c,limitReached:n[t.id].limitReached,firstMessageID:n[t.id].firstMessageID,audio:e.pathID===t.id&&o}}return Object(s.a)(Object(s.a)({},e),{},{dispatchMessages:n})}return n[t.id]={messages:t.messages,limitReached:"no id"===n[t.id].firstMessageID||(null===(a=t.messages[0])||void 0===a?void 0:a.id)===n[t.id].firstMessageID,firstMessageID:n[t.id].firstMessageID,audio:!1},Object(s.a)(Object(s.a)({},e),{},{dispatchMessages:n});case"set_audio_false":var l=e.dispatchMessages;return l[t.id]=Object(s.a)(Object(s.a)({},l[t.id]),{},{audio:!1}),Object(s.a)(Object(s.a)({},e),{},{dispatchMessages:l});case"set_firstMessage":var u=e.dispatchMessages;return u[t.id]?u[t.id].firstMessageID=t.firstMessageID:u[t.id]={firstMessageID:t.firstMessageID},Object(s.a)(Object(s.a)({},e),{},{dispatchMessages:u});case"update_media":var d=e.dispatchMessages,h=d[t.roomID].messages,j=h.findIndex((function(e){return e.id===t.id}));return h[j]=Object(s.a)(Object(s.a)({},h[j]),t.data),d[t.roomID]={messages:h,limitReached:d[t.roomID].limitReached,firstMessageID:d[t.roomID].firstMessageID},Object(s.a)(Object(s.a)({},e),{},{dispatchMessages:d});case"add_rooms_data":var m=Object(s.a)({},e.roomsData);return m[t.roomID]={lastMessageListener:t.lastMessageListener,onlineStatelistener:t.onlineStatelistener,roomID:t.roomID},Object(s.a)(Object(s.a)({},e),{},{roomsData:m});case"update_rooms_data":var g=Object(s.a)({},e.roomsData);return t.data!==g[t.roomID][t.dataType]?(g[t.roomID]=Object(s.a)(Object(s.a)({},g[t.roomID]),{},Object(v.a)({},t.dataType,t.data)),Object(s.a)(Object(s.a)({},e),{},{roomsData:g})):e;default:return e}},_=a(2),I=Object(n.createContext)(),D=function(e){var t=e.reducer,a=e.initialState,c=e.children;return Object(_.jsx)(I.Provider,{value:[].concat(Object(O.a)(Object(n.useReducer)(t,a)),[y]),children:c})},L=function(){return Object(n.useContext)(I)};function N(e){var t=e.dataList,a=e.title,c=e.path,r=e.fetchList,o=L(),s=Object(i.a)(o,2),l=s[0],u=l.roomsData,d=l.page,O=l.pathID,v=s[1],x=Object(n.useState)(!1),w=Object(i.a)(x,2),y=w[0],S=w[1],I=Object(n.useState)(null),D=Object(i.a)(I,2),N=D[0],R=D[1],k=Object(n.useRef)();return Object(n.useEffect)((function(){var e=null;r&&(e=function(){parseInt(k.current.scrollTop)===k.current.scrollHeight-k.current.offsetHeight&&r(S)},(null===t||void 0===t?void 0:t.length)>0&&k.current.addEventListener("scroll",e));var a=k.current;return function(){e&&a.removeEventListener("scroll",e)}}),[t,r]),Object(n.useEffect)((function(){(null===t||void 0===t?void 0:t.length)===(null===N||void 0===N?void 0:N.length)&&setTimeout((function(){Array.from(document.querySelectorAll(".animate")).forEach((function(e,t){setTimeout((function(){e.classList.remove("animate")}),50*t)}))}),10)}),[t,N]),Object(n.useEffect)((function(){if(t){var e=[];t.forEach((function(t){if(t){var n,r,o=(null===(n=u[t.id])||void 0===n?void 0:n.onlineState)?u[t.id].onlineState:t.state,s="Search Result"===a?null:(null===(r=u[t.id])||void 0===r?void 0:r.lastMessage)?u[t.id].lastMessage:t.lastMessage;("Rooms"===a||"Search Result"===a||"Chats"===a&&u[t.id].lastMessage||"Chats"!==a&&u[t.id])&&e.push(Object(_.jsx)(f.b,{className:"link",to:{pathname:c?"".concat(c,"/room/").concat(t.id):"/room/".concat(t.id),state:{photoURL:"".concat(t.photoURL?t.photoURL:"https://avatars.dicebear.com/api/human/".concat(t.id,".svg")),name:t.name,about:t.about,phone:t.phone,userID:t.userID?t.userID:null,state:t.state}},children:Object(_.jsxs)("div",{className:"sidebar__chat animate",children:[Object(_.jsxs)("div",{className:"avatar__container",children:[Object(_.jsx)(h.a,{style:{width:45,height:45},src:"".concat(t.photoURL?t.photoURL:"https://avatars.dicebear.com/api/human/".concat(t.id,".svg"))}),"online"===o?Object(_.jsx)("div",{className:"online"}):null]}),Object(_.jsxs)("div",{className:"sidebar__chat--info",children:[Object(_.jsx)("h2",{dangerouslySetInnerHTML:{__html:"\u0420\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442 \u043f\u043e\u0438\u0441\u043a\u0430"===a?t._highlightResult.name.value:t.name},style:{width:d.width<=760?d.width-126:.315*d.width-126,marginBottom:(null===s||void 0===s?void 0:s.message)||s?8:0}}),Object(_.jsx)("p",{style:{width:d.width<=760?d.width-126:.315*d.width-126},dangerouslySetInnerHTML:{__html:t.about}}),Object(_.jsx)("p",{style:{width:d.width<=760?d.width-126:.315*d.width-126},children:(null===s||void 0===s?void 0:s.message)?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(j.a,{style:{width:19,height:19}})," ",Object(_.jsx)("span",{style:{width:d.width<=160?d.width-150:.315*d.width-150},children:s.message})," "]}):(null===s||void 0===s?void 0:s.audio)?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(m.a,{style:{width:19,height:19}}),Object(_.jsx)("span",{style:{width:d.width<=160?d.width-150:.315*d.width-150},children:s.time})]}):""===(null===s||void 0===s?void 0:s.message)?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(j.a,{style:{width:19,height:19}})," ",Object(_.jsx)("span",{style:{width:d.width<=160?d.width-150:.315*d.width-150},children:"Photo"})," "]}):s})]}),(null===t||void 0===t?void 0:t.unreadMessages)&&O!==t.id?Object(_.jsx)("div",{className:"sidebar__chat--unreadMessages",children:Object(_.jsx)("div",{children:t.unreadMessages})}):null]})},t.id))}else e.push(null)})),R(e)}}),[t,u,d,O]),Object(n.useEffect)((function(){d.width<=160?v({type:"SET_PATH",path:c}):v({type:"SET_PATH",path:""})}),[c,d]),Object(_.jsxs)("div",{ref:k,className:"sidebar__chat--container",children:[Object(_.jsxs)("h2",{className:"animate",children:[a," "]}),(null===t||void 0===t?void 0:t.length)>0?N:null===t&&"Chats"!==a?Object(_.jsx)("div",{className:"loader__container sidebar__loader",children:Object(_.jsx)(p.a,{})}):Object(_.jsxs)("div",{className:"no-result",children:[Object(_.jsxs)("div",{children:[Object(_.jsx)(g.a,{}),Object(_.jsx)("div",{className:"cancel-root",children:Object(_.jsx)(b.a,{})})]}),Object(_.jsxs)("h2",{children:[" ",a," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e "]})]}),Object(_.jsx)("div",{className:"loader__container scrollFetch",children:y?Object(_.jsx)(p.a,{}):null})]})}var R=Object(n.memo)(N),k=a(221),M=a(220),C=a(217),E=a(219),U=a(218),T=a(247),P=a.p+"static/media/tablets.13043575.png";var H=function(){var e=Object(n.useState)(!localStorage.getItem("role")),t=Object(i.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(localStorage.getItem("role")),o=Object(i.a)(r,2),s=o[0],l=o[1],u=function(){c(!0)};return Object(_.jsxs)("div",{children:[Object(_.jsxs)("span",{style:{cursor:"pointer"},onClick:function(){return u()},children:[Object(_.jsx)("img",{src:P,alt:"YouLrole",style:{maxWidth:40,paddingTop:20,cursor:"pointer"},onClick:function(){return u()}}),s]}),Object(_.jsxs)(C.a,{open:a,"aria-labelledby":"form-dialog-title",children:[Object(_.jsxs)(T.a,{id:"form-dialog-title",children:["\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043a\u0442\u043e \u0432\u044b \u0441\u0435\u0433\u043e\u0434\u043d\u044f:"," "]}),Object(_.jsx)(U.a,{children:Object(_.jsx)("img",{src:P,alt:"YouLrole",style:{maxWidth:"100%"}})}),Object(_.jsxs)(E.a,{style:{justifyContent:"space-around"},children:[Object(_.jsx)(M.a,{onClick:function(e){e.preventDefault(),localStorage.setItem("role","\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c"),localStorage.setItem("searchrole","\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440"),c(!1),l("\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c")},color:"primary",children:"\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c"}),Object(_.jsx)(M.a,{onClick:function(e){e.preventDefault(),localStorage.setItem("role","\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440"),localStorage.setItem("searchrole","\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c"),c(!1),l("\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440")},color:"primary",children:"\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440"})]})]})]})},A=a(224),F=a(225),W=a(226),q=a(227),B=a(20),z=(a(87),a.p+"static/media/notification.34e1d6f8.mp3"),G=a(241),Y=a(245);var X=function(e){var t=e.menuLists,a=e.menu,n=e.handleMenuClose;return Object(_.jsx)("div",{children:Object(_.jsx)(G.a,{id:"simple-menu",anchorEl:a,keepMounted:!0,open:Boolean(a),onClose:n,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},getContentAnchorEl:null,children:t.map((function(e){return Object(_.jsx)(Y.a,{onClick:e.onClick,children:e.title},e.id)}))})})},V=a(113),J=function(e,t,a){V.a.info(e,{toastId:t,position:a,autoClose:5e3,hideProgressBar:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0,progress:void 0})},K=a(222),Z=a(60),$=a.n(Z);a(148);var Q=function(e){var t=e.open,a=e.close,n=e.user,c=e.photo;return Object(_.jsxs)(C.a,{open:t,fullScreen:!0,onClose:a,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(_.jsxs)(T.a,{id:"alert-dialog-title-dialogCustom",children:[Object(_.jsx)("div",{children:Object(_.jsx)(h.a,{src:n.photoURL})}),Object(_.jsx)("div",{children:Object(_.jsx)(k.a,{edge:"end",color:"inherit",onClick:a,"aria-label":"close",children:Object(_.jsx)($.a,{})})})]}),Object(_.jsx)(U.a,{children:Object(_.jsx)(K.a,{in:t,style:{transitionDelay:t?"300ms":"0ms"},children:Object(_.jsx)("img",{src:c,alt:"",className:"DialogCustom__photo"})})})]})},ee=a(248),te=a(223),ae=a(115),ne=a.n(ae),ce=a(114),re=a.n(ce),oe=a(79),se=a.n(oe),ie=a(66),le=a.n(ie),ue=(a(150),Object(te.a)((function(e){return{root:{display:"flex"},drawerPaper:{position:"absolute"}}})));var de=function(e){var t=e.drawerLeft,a=e.setDrawerLeft,c=e.db,r=e.auth,o=e.storage,s=ue(),l=L(),j=Object(i.a)(l,1)[0].user,m=Object(n.useState)(""),g=Object(i.a)(m,2),b=g[0],f=g[1],p=Object(n.useState)(""),O=Object(i.a)(p,2),v=O[0],x=O[1],w=Object(n.useState)(""),y=Object(i.a)(w,2),S=y[0],I=y[1],D=Object(n.useState)(!1),N=Object(i.a)(D,2),R=N[0],M=N[1],P=Object(n.useState)(!1),H=Object(i.a)(P,2),A=H[0],F=H[1],W=Object(n.useState)(!1),q=Object(i.a)(W,2),B=q[0],z=q[1],G=Object(n.useState)(!1),Y=Object(i.a)(G,2),V=Y[0],Z=Y[1],$=Object(n.useState)(null),te=Object(i.a)($,2),ae=te[0],ce=te[1],oe=Object(n.useState)(!1),ie=Object(i.a)(oe,2),de=ie[0],he=ie[1],je=Object(n.useState)(null),me=Object(i.a)(je,2),ge=me[0],be=me[1],fe=Object(n.useState)(""),pe=Object(i.a)(fe,2),Oe=pe[0],ve=pe[1];Object(n.useEffect)((function(){f(j.displayName),c.collection("users").doc(j.uid).onSnapshot((function(e){var t,a,n;ve(null===(t=e.data())||void 0===t?void 0:t.photoURL),x(null===(a=e.data())||void 0===a?void 0:a.about),I(null===(n=e.data())||void 0===n?void 0:n.phone)}))}),[j.uid,j.displayName,c]);var xe=function(){var e=Object(d.a)(u.a.mark((function e(t){var a,n,c,r,s,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("imageFileSizeToastId",!((a=t.target.files[0]).size>3145728)){e.next=6;break}J("\u0424\u043e\u0442\u043a\u0430 \u043d\u0435 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 3Mb","imageFileSizeToastId","top-center"),e.next=30;break;case 6:if(n=o.ref(),!0!==j.isAnonymous){e.next=20;break}return c=n.child("user/anonymous/".concat(j.uid)),r=c.child(a.name),e.next=12,r.put(a);case 12:return e.t0=ce,e.next=15,r.getDownloadURL();case 15:e.t1=e.sent,(0,e.t0)(e.t1),console.log("uploading image",ae),e.next=30;break;case 20:return s=n.child("user/regular/".concat(j.uid)),i=s.child(a.name),e.next=24,i.put(a);case 24:return e.t2=ce,e.next=27,i.getDownloadURL();case 27:e.t3=e.sent,(0,e.t2)(e.t3),console.log("uploading image",ae);case 30:be(null),he(!0);case 32:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),we=function(){ae?(r.currentUser.updateProfile({photoURL:ae}),c.collection("rooms").doc(j.uid).set({photoURL:ae},{merge:!0}),he(!1)):J("Select photo to upload!","uploadPhotoError","top-center")},ye=[{title:"\u0423\u0432\u0435\u043b\u0438\u0447\u0438\u0442\u044c",onClick:function(){return j?Z(!0):J("\u041d\u0435\u0442 \u0444\u043e\u0442\u043e!","viewPhoto","top-center"),void be(null)},id:1e5*Math.random()},{title:Object(_.jsxs)("div",{className:"profileMenu_uploadPhoto",children:[Object(_.jsx)("label",{htmlFor:"file-input",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u043e\u0442\u043e"}),Object(_.jsx)("input",{id:"file-input",type:"file",onChange:xe,accept:"image/*"})]}),onClick:function(){return we()},id:1e5*Math.random()}];return Object(_.jsx)("div",{children:Object(_.jsxs)(ee.a,{anchor:"left",variant:"persistent",open:t,classes:{paper:s.drawerPaper},children:[Object(_.jsx)("div",{className:"drawerLeft__header",children:Object(_.jsxs)("div",{className:"drawerLeft__header_container",children:[Object(_.jsx)(k.a,{onClick:function(){a(!1),M(!1),F(!1),z(!1)},children:Object(_.jsx)(re.a,{})}),Object(_.jsx)("p",{children:"\u0412\u0430\u0448 \u043f\u0440\u043e\u0444\u0438\u043b\u044c \u0438 \u0432\u0430\u0448\u0430 \u0437\u0430\u044f\u0432\u043a\u0430"})]})}),Object(_.jsxs)("div",{className:"drawerLeft__content",children:[Object(_.jsxs)("div",{className:"drawerLeft__content_photo",children:[Object(_.jsxs)("div",{className:"profilePhoto",children:[Object(_.jsx)(K.a,{in:t,style:{transitionDelay:t?"300ms":"0ms"},children:Oe?Object(_.jsx)(h.a,{src:Oe,className:"profilePhoto__layer_bottom"}):Object(_.jsx)(h.a,{})}),Object(_.jsx)("div",{className:"profilePhoto__layer_top",onClick:function(e){be(e.currentTarget)},children:Object(_.jsxs)("div",{className:"profilePhoto__text",children:[Object(_.jsx)(ne.a,{}),Object(_.jsx)("p",{children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"}),Object(_.jsx)("p",{children:"\u0424\u043e\u0442\u043e"})]})})]}),Object(_.jsx)(X,{menuLists:ye,menu:ge,handleMenuClose:function(){be(null)}}),Object(_.jsx)(Q,{open:V,close:function(){Z(!1)},photo:Oe,user:j})]}),Object(_.jsx)("div",{className:"profileMenu__diaglog",children:Object(_.jsxs)(C.a,{open:de,onClose:function(){he(!1)},"aria-labelledby":"form-dialog-title",children:[Object(_.jsx)(T.a,{id:"form-dialog-title-drawerLeft",children:"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0444\u043e\u0442\u043e(\u0435\u0441\u043b\u0438 \u0432\u044b \u0432\u043e\u0434\u0438\u0442\u0435\u043b\u044c, \u0442\u043e \u043c\u043e\u0436\u043d\u043e \u0444\u043e\u0442\u043e \u043c\u0430\u0448\u0438\u043d\u044b)"}),Object(_.jsx)(U.a,{id:"form-dialog-content",children:Object(_.jsx)("div",{className:"profileMenu__uploadPhoto_dialog",children:Object(_.jsx)("img",{src:ae,alt:""})})}),Object(_.jsx)(E.a,{children:Object(_.jsx)("div",{className:"profileMenu_uploadPhoto_iconButton",children:Object(_.jsx)(k.a,{onClick:we,children:Object(_.jsx)(le.a,{})})})})]})}),Object(_.jsxs)("div",{className:"drawerLeft__content_name",children:[Object(_.jsxs)("p",{children:["\u0412\u0430\u0448\u0435 \u0438\u043c\u044f \u0438 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435","\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c"==localStorage.getItem("role")?Object(_.jsx)("span",{className:"span_namer",children:"\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0412\u0430\u0441\u044f, \u0435\u0437\u0436\u0443 \u043a\u0430\u0436\u0434\u044b\u0439 \u0434\u0435\u043d\u044c \u0432 \u041c\u0430\u043a\u0435\u0435\u0432\u043a\u0443, \u0432 10 \u0443\u0442\u0440\u0430"}):Object(_.jsx)("span",{className:"span_namer",children:"\u041d\u0430\u043f\u0440\u0438\u043c\u0435\u0440 \u0410\u043d\u044f, \u043f\u0430\u0441\u0441\u0430\u0436\u0438\u0440, \u0435\u0437\u0436\u0443 \u043a\u0430\u0436\u0434\u044b\u0439 \u0434\u0435\u043d\u044c \u0432 \u0446\u0435\u043d\u0442\u0440 \u0414\u043e\u043d\u0435\u0446\u043a\u0430 \u0441 \u0422\u0435\u043a\u0441\u0442\u0438\u043b\u044c\u0449\u0438\u043a\u0430 \u0432 8 \u0443\u0442\u0440\u0430, \u043a\u0442\u043e \u043f\u043e\u0434\u0432\u0435\u0437\u0435\u0442?"})]}),Object(_.jsx)("form",{children:R?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("input",{value:b,onChange:function(e){return f(e.target.value)},type:"text",styles:{borderBottom:"1px solid green !important"}}),Object(_.jsx)(le.a,{onClick:function(e){e.preventDefault(),j.uid&&(c.collection("users").doc(j.uid).update({name:b}).then((function(){console.log("\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e!")})).catch((function(e){console.error("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c: ",e)})),r.currentUser.updateProfile({displayName:b})),M(!1)}})]}):Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("span",{children:b}),Object(_.jsx)(se.a,{onClick:function(){M(!0)}})]})})]}),Object(_.jsx)("div",{className:"drawerLeft__note",children:Object(_.jsx)("span",{children:"\u041d\u0430\u043f\u0438\u0448\u0438\u0442\u0435 \u0438\u043c\u044f \u0438 \u043e\u0441\u0442\u0430\u0432\u044c\u0442\u0435 \u0441\u0432\u043e\u0435 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435"})}),Object(_.jsxs)("div",{className:"drawerLeft__content_name",children:[Object(_.jsx)("p",{children:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d"}),Object(_.jsx)("form",{children:B?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("input",{value:S,onChange:function(e){return I(e.target.value)},type:"text"}),Object(_.jsx)(le.a,{onClick:function(e){e.preventDefault(),j.uid&&c.collection("users").doc(j.uid).update({phone:S}).then((function(){console.log("\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e phone!")})).catch((function(e){console.error("\u041d\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u043e\u0441\u044c \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c phone: ",e)})),z(!1)}})]}):Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("span",{children:S}),Object(_.jsx)(se.a,{onClick:function(){z(!0)}})]})})]}),Object(_.jsxs)("div",{className:"drawerLeft__content_name",children:[Object(_.jsx)("p",{children:"\u041e\u0431\u043e \u043c\u043d\u0435"}),Object(_.jsx)("form",{children:A?Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("input",{value:v,onChange:function(e){return x(e.target.value)},type:"text"}),Object(_.jsx)(le.a,{onClick:function(e){e.preventDefault(),j.uid&&c.collection("users").doc(j.uid).update({about:v}).then((function(){console.log("\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u043e!")})).catch((function(e){console.error("\u041d\u0435 \u043f\u043e\u043b\u0443\u0447\u0438\u043b\u043e\u0441\u044c \u043e\u0431\u043d\u043e\u0432\u0438\u0442\u044c: ",e)})),F(!1)}})]}):Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("span",{children:v}),Object(_.jsx)(se.a,{onClick:function(){F(!0)}})]})})]})]})]})})},he=a(36),je=(a(151),a(181),a(153),a(180),a(182),he.a.initializeApp({apiKey:"AIzaSyBEEA2tvNgeHIYxDRJgkxDfZIBguDnybPc",authDomain:"whatsapp2-a5f92.firebaseapp.com",databaseURL:"https://whatsapp2-a5f92-default-rtdb.firebaseio.com",projectId:"whatsapp2-a5f92",storageBucket:"whatsapp2-a5f92.appspot.com",messagingSenderId:"1023177696506",appId:"1:1023177696506:web:a180739d1dd334d1f7d543",measurementId:"G-XG4H351X5E"})),me=je.firestore(),ge=je.database(),be=je.auth(),fe=new he.a.auth.GoogleAuthProvider,pe=he.a.firestore.FieldValue.serverTimestamp,Oe=he.a.database.ServerValue.TIMESTAMP,ve="serviceWorker"in navigator&&"PushManager"in window?he.a.messaging():null,xe=he.a.firestore.FieldValue.increment,we=(he.a.firestore.FieldValue.arrayUnion,he.a.storage().ref("images")),ye=he.a.storage(),Se=he.a.storage().ref("audios"),_e=me;function Ie(e){var t,a=e.chats,c=e.pwa,r=e.rooms,o=e.fetchRooms,s=e.users,l=e.fetchUsers,j=(e.usersSearch,e.fetchUsersSearch,Object(n.useState)(!1)),m=Object(i.a)(j,2),b=m[0],p=m[1],O=Object(n.useState)(null),v=Object(i.a)(O,2),x=(v[0],v[1],Object(n.useState)(null)),w=Object(i.a)(x,2),y=(w[0],w[1]),S=Object(n.useState)(null),I=Object(i.a)(S,2),D=I[0],N=I[1],M=Object(n.useState)(null),C=Object(i.a)(M,2),E=C[0],U=C[1],T=Object(n.useState)(""),P=Object(i.a)(T,2),G=P[0],Y=P[1],X=Object(n.useState)(1),V=Object(i.a)(X,2),J=V[0],K=V[1],Z=Object(n.useState)(!1),$=Object(i.a)(Z,2),Q=$[0],ee=$[1],te=L(),ae=Object(i.a)(te,1)[0],ne=ae.user,ce=ae.page,re=ae.pathID,oe=Object(B.g)(),se=new Audio(z),ie=Object(n.useRef)(function(){var e={};return a.forEach((function(t){return t.unreadMessages||0===t.unreadMessages?e[t.id]=t.unreadMessages:null})),e}());function le(){return le=Object(d.a)(u.a.mark((function e(t){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(document.querySelector(".sidebar__search input").blur(),t.preventDefault()),ce.width<=160&&oe.push("/search?"+G),y(null),4!==J&&K(4),a=s.filter((function(e,t,a){return e.name.toLowerCase().indexOf(G.toLowerCase())>-1})),N(a);case 6:case"end":return e.stop()}}),e)}))),le.apply(this,arguments)}t=ce.width>160?function(e){return Object(_.jsx)("div",{className:"".concat(e.classSelected?"sidebar__menu--selected":""),onClick:e.click,children:e.children})}:f.c;function ue(){return(ue=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:3!==J&&K(3),t=s.filter((function(e,t,a){return e.searchrole.toLowerCase().indexOf("\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440".toLowerCase())>-1})),U(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function he(){return(he=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:2!==J&&K(2),t=s.filter((function(e,t,a){return e.searchrole.toLowerCase().indexOf("\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u044c".toLowerCase())>-1})),U(t);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(){return(je=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:1!==J&&K(1),oe.push("/");case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(n.useEffect)((function(){var e={};a.forEach((function(t){(t.unreadMessages||0===t.unreadMessages)&&((t.unreadMessages>ie.current[t.id]||!ie.current[t.id]&&0!==ie.current[t.id])&&re!==t.id&&se.play(),e[t.id]=t.unreadMessages)})),ie.current=e}),[a,re]),Object(n.useEffect)((function(){ce.width<=160&&a&&!Q&&(ee(!0),setTimeout((function(){document.querySelector(".sidebar").classList.add("side")}),10))}),[a,Q]),Object(_.jsxs)("div",{className:"sidebar",style:{},children:[Object(_.jsxs)("div",{className:"sidebar__header",children:[Object(_.jsxs)("div",{className:"sidebar__header--left",children:[Object(_.jsx)(h.a,{src:null===ne||void 0===ne?void 0:ne.photoURL,onClick:function(){p(!0)}}),Object(_.jsxs)("h4",{children:[null===ne||void 0===ne?void 0:ne.displayName," "]})]}),Object(_.jsx)(de,{drawerLeft:b,setDrawerLeft:p,db:_e,auth:be,storage:ye}),Object(_.jsxs)("div",{className:"sidebar__header--right",children:[Object(_.jsx)(k.a,{onClick:function(){c?(console.log("prompting the pwa event"),c.prompt()):console.log("pwa event is undefined")},children:Object(_.jsx)(A.a,{})}),Object(_.jsx)(H,{uid:ne.uid})]})]}),Object(_.jsx)("div",{className:"sidebar__search",children:Object(_.jsxs)("form",{className:"sidebar__search--container",children:[Object(_.jsx)(g.a,{}),Object(_.jsx)("input",{value:G,onChange:function(e){return Y(e.target.value)},placeholder:"\u041f\u043e\u0438\u0441\u043a",type:"text"}),Object(_.jsx)("button",{style:{display:"none"},type:"submit",onClick:function(e){return le.apply(this,arguments)}})]})}),Object(_.jsxs)("div",{className:"sidebar__menu",children:[Object(_.jsx)(t,{classSelected:1===J,to:"/",click:function(){return je.apply(this,arguments)},activeClassName:"sidebar__menu--selected",children:Object(_.jsxs)("div",{className:"sidebar__menu--users",children:[Object(_.jsx)(F.a,{}),Object(_.jsx)("div",{className:"sidebar__menu--line"})]})}),Object(_.jsx)(t,{classSelected:2===J,to:"/users",click:function(){return he.apply(this,arguments)},activeClassName:"sidebar__menu--selected",children:Object(_.jsxs)("div",{className:"sidebar__menu--users",children:[Object(_.jsx)(W.a,{}),Object(_.jsx)("div",{className:"sidebar__menu--line"})]})}),Object(_.jsx)(t,{classSelected:3===J,to:"/users",click:function(){return ue.apply(this,arguments)},activeClassName:"sidebar__menu--selected",children:Object(_.jsxs)("div",{className:"sidebar__menu--users",children:[Object(_.jsx)(q.a,{}),Object(_.jsx)("div",{className:"sidebar__menu--line"})]})})]}),ce.width<=160?Object(_.jsx)(_.Fragment,{children:Object(_.jsxs)(B.d,{children:[Object(_.jsx)(B.b,{path:"/users",children:Object(_.jsx)(R,{fetchList:l,dataList:s,title:"Users",path:"/users"},"users")}),Object(_.jsx)(B.b,{path:"/rooms",children:Object(_.jsx)(R,{fetchList:o,dataList:r,title:"Rooms",path:"/rooms"},"rooms")}),Object(_.jsx)(B.b,{path:"/search",children:Object(_.jsx)(R,{fetchList:l,dataList:D,title:"Search Result",path:"/search"},"search")}),Object(_.jsx)(B.b,{path:"/chats",children:Object(_.jsx)(R,{dataList:a,title:"Chats1",path:"/chats"},"chats")})]})}):1===J?Object(_.jsx)(R,{fetchList:l,dataList:s},"users"):2===J?Object(_.jsx)(R,{fetchList:l,dataList:E,title:"\u041f\u0430\u0441\u0441\u0430\u0436\u0438\u0440\u044b"},"usersPas"):3===J?Object(_.jsx)(R,{fetchList:l,dataList:E,title:"\u0412\u043e\u0434\u0438\u0442\u0435\u043b\u0438"},"usersDr"):4===J?Object(_.jsx)(R,{fetchList:l,dataList:D,title:"\u041f\u043e\u0438\u0441\u043a"},"search"):null]})}var De=Object(n.memo)(Ie),Le=a(243),Ne=a(244),Re=a(67),ke=a(231),Me=a(232),Ce=a(233),Ee=a(237),Ue=a(238),Te=a(78),Pe=a.n(Te),He=(a(156),Object(n.memo)((function(e){var t=e.imageSRC,a=e.mediaPreview,c=e.close,r=Object(n.useState)(""),o=Object(i.a)(r,2),s=o[0],l=o[1];return Object(n.useEffect)((function(){l(document.querySelector(".chat__body--container").offsetHeight)}),[]),Object(_.jsxs)("div",{ref:a,className:"mediaPreview",style:{height:s},children:[Object(_.jsx)(Pe.a,{onClick:c}),Object(_.jsx)("img",{src:t,alt:""},t)]})}))),Ae=(a(157),Object(n.memo)((function(e){var t=e.imagePreview,a=e.animState,c=Object(B.g)(),o=Object(n.useState)(!1),s=Object(i.a)(o,2),l=s[0],u=s[1],d=L(),h=Object(i.a)(d,1)[0].page;Object(n.useEffect)((function(){if(l){var e,n,c,r=h.height/h.width,o=document.querySelector(".imagePreview-container"),s=t.ratio?t.ratio:t.imgH/t.imgW;r<s?(c=!0,e=1/s*h.height,n=h.height):(c=!1,n=s*h.width,e=h.width),"entering"===a||"entered"===a?setTimeout((function(){document.querySelector(".imagePreview").style.backgroundColor="black",o.style.borderRadius="0px",o.style.transformOrigin="0% 0%",o.style.height=t.imgH+"px",o.style.transform=c?"translateX(".concat(h.width/2-e/2,"px) translateY(0px) scale(").concat(h.height/t.imgH,")"):"translateX(0px) translateY(".concat(h.height/2-n/2,"px) scale(").concat(h.width/t.width,")"),setTimeout((function(){document.querySelector(".imagePreview .MuiSvgIcon-root").classList.add("close-animate")}),300)}),10):"exiting"===a&&setTimeout((function(){document.querySelector(".imagePreview .MuiSvgIcon-root").classList.remove("close-animate"),setTimeout((function(){document.querySelector(".imagePreview").style.backgroundColor="transparent"}),200),o.style.borderRadius="10px",o.style.height=t.height+"px",o.style.transform="translateX(".concat(t.left,"px) translateY(").concat(t.top,"px) scale(1)")}),10)}}),[a,l]);var j={transform:"translateX(".concat(t.left,"px) translateY(").concat(t.top,"px) scale(1)"),width:t.width,height:t.height},m={};return h.height/h.width>t.ratio||h.height/h.width===t.ratio?m.minWidth="100%":(m.minHeight="100%",t.imgW<t.width&&(m.minWidth="100%")),Object(r.createPortal)(Object(_.jsxs)("div",{className:"imagePreview",onClick:function(){return document.querySelector(".imagePreview .MuiSvgIcon-root").classList.toggle("close-animate")},children:[Object(_.jsx)(Pe.a,{onClick:function(){return c.goBack()}}),Object(_.jsx)("div",{className:"imagePreview-container",style:j,children:Object(_.jsx)("img",{style:m,onLoad:function(){return u(!0)},src:t.src,alt:""})})]}),document.querySelector(".app"))}))),Fe=a(228),We=a(229),qe=a(230),Be=a(242);function ze(){return new Promise((function(e){navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){var a=new MediaRecorder(t),n=[];a.addEventListener("dataavailable",(function(e){n.push(e.data)}));e({start:function(){a.start()},stop:function(){return new Promise((function(e){a.addEventListener("stop",(function(){var t=Object(Be.a)(),a=new File(n,t,{type:"audio/mpeg"}),c=URL.createObjectURL(a),r=new Audio(c);e({audioFile:a,audioUrl:c,play:function(){r.play()},audioName:t})})),a.stop()}))}})}))}))}a(158);var Ge=function(e){return new Promise((function(t){return setTimeout(t,e)}))},Ye=Object(n.memo)((function(e){var t=e.input,a=e.handleFocus,c=e.change,r=e.sendMessage,o=e.setFocus,s=e.image,l=e.focus,h=e.state,j=e.token,g=e.roomID,b=e.setAudioID,f=Object(n.useState)(!1),p=Object(i.a)(f,2),O=p[0],x=p[1],w=Object(n.useState)("00:00"),y=Object(i.a)(w,2),S=y[0],I=y[1],D=L(),N=Object(i.a)(D,1)[0].user,R=Object(n.useRef)(),k=Object(n.useRef)(),M=Object(n.useRef)(),C=Object(n.useRef)();function E(e,t,a){return U.apply(this,arguments)}function U(){return U=Object(d.a)(u.a.mark((function e(t,a,n){var c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _e.collection("rooms").doc(g).set(Object(v.a)({},N.uid,!1),{merge:!0}),_e.collection("rooms").doc(g).set({lastMessage:{audio:!0,time:a},seen:!1},{merge:!0}),h.userID?(_e.collection("users").doc(h.userID).collection("chats").doc(g).set({timestamp:pe(),photoURL:N.photoURL?N.photoURL:null,name:N.displayName,userID:N.uid,unreadMessages:xe(1)},{merge:!0}),_e.collection("users").doc(N.uid).collection("chats").doc(g).set({timestamp:pe(),photoURL:h.photoURL?h.photoURL:null,name:h.name,userID:h.userID},{merge:!0})):_e.collection("users").doc(N.uid).collection("chats").doc(g).set({timestamp:pe(),photoURL:h.photoURL?h.photoURL:null,name:h.name}),e.next=6,_e.collection("rooms").doc(g).collection("messages").add({name:N.displayName,uid:N.uid,timestamp:pe(),time:(new Date).toUTCString(),audioUrl:"uploading",audioName:n,audioPlayed:!1});case 6:return c=e.sent,e.next=9,Se.child(n).put(t);case 9:return e.next=11,Se.child(n).getDownloadURL();case 11:r=e.sent,_e.collection("rooms").doc(g).collection("messages").doc(c.id).update({audioUrl:r}),h.userID&&""!==j&&_e.collection("notifications").add({userID:N.uid,title:N.displayName,body:"\ud83c\udf99\ufe0f "+a,photoURL:N.photoURL,token:j});case 15:case"end":return e.stop()}}),e)}))),U.apply(this,arguments)}function T(){return(T=Object(d.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!window.navigator.onLine){e.next=15;break}return l&&k.current.focus(),e.next=5,Ge(150);case 5:return e.next=7,ze();case 7:return C.current=e.sent,b(null),k.current.style.width="calc(100% - 56px)",e.next=12,Ge(305);case 12:x(!0),e.next=16;break;case 15:alert("No access to internet !!!");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(){return H.apply(this,arguments)}function H(){return(H=Object(d.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l&&k.current.focus(),_e.collection("rooms").doc(g).set(Object(v.a)({},N.uid,!1),{merge:!0}),clearInterval(M.current),t=C.current.stop(),R.current.style.opacity="0",e.next=7,Ge(300);case 7:return x(!1),k.current.style.width="calc(100% - 112px)",a=S,I("00:00"),e.abrupt("return",[t,a]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=Object(d.a)(u.a.mark((function e(){var t,a,n,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P();case 2:return t=e.sent,a=Object(i.a)(t,2),n=a[0],c=a[1],e.next=8,n;case 8:E((n=e.sent).audioFile,c,n.audioName);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){var t=e+"";return t.length<2?"0"+t:t}function W(){var e=Date.now();M.current=setInterval((function(){var t=Date.now()-e,a=Math.floor(t/1e3);I(F(parseInt(a/60))+":"+F(a%60))}),100)}Object(n.useEffect)((function(){var e=function(){var e=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ge(10);case 2:return R.current.style.opacity="1",e.next=5,Ge(100);case 5:W(),_e.collection("rooms").doc(g).set(Object(v.a)({},N.uid,"recording"),{merge:!0}),C.current.start();case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();O&&e()}),[O]);var q=Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)(Le.a,{in:""!==t||""===t&&s,timeout:{enter:400,exit:200},classNames:"send__animate2",children:Object(_.jsx)(Fe.a,{style:{width:20,height:20,color:"white"}})}),Object(_.jsx)(Le.a,{in:!(""!==t||""===t&&s),timeout:{enter:400,exit:200},classNames:"send__animate",children:Object(_.jsx)(m.a,{style:{width:24,height:24,color:"white"}})})]});return Object(_.jsxs)("div",{className:"chat__footer",onBlur:function(e){e.currentTarget.contains(e.relatedTarget)||O||o(!1)},children:[Object(_.jsxs)("form",{children:[Object(_.jsx)("input",{ref:k,value:t,onClick:a,onChange:O?null:c,onKeyPress:O?function(){return!1}:null,onFocus:function(){return o(!0)},placeholder:"\u041f\u0438\u0448\u0438\u0442\u0435"}),navigator.mediaDevices.getUserMedia&&window.MediaRecorder?Object(_.jsx)("button",{type:"submit",className:"send__btn",onClick:""!==t||""===t&&s?r:function(e){return T.apply(this,arguments)},children:q}):Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("label",{for:"capture",className:"send__btn",children:q}),Object(_.jsx)("input",{style:{display:"none"},type:"file",id:"capture",accept:"audio/*",capture:!0,onChange:function(e){if(window.navigator.onLine){var t=e.target.files[0];if(t){b(null);var a=new Audio(URL.createObjectURL(t));a.addEventListener("loadedmetadata",(function(){var e=Math.floor(a.duration),n=F(parseInt(e/60))+":"+F(e%60);E(t,n,Object(Be.a)())}))}}else alert("\u041d\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0443!")}})]})]}),O?Object(_.jsxs)("div",{ref:R,className:"record",children:[Object(_.jsx)(We.a,{style:{width:30,height:30,color:"#F20519"},onClick:P}),Object(_.jsxs)("div",{children:[Object(_.jsx)("div",{className:"record__redcircle"}),Object(_.jsx)("div",{className:"record__duration",children:S})]}),Object(_.jsx)(qe.a,{style:{width:30,height:30,color:"#41BF49"},onClick:function(){return A.apply(this,arguments)}})]}):null]})})),Xe=a(116),Ve=a.n(Xe),Je=a(80),Ke=a(118),Ze=a.n(Ke),$e=a(117),Qe=a.n($e),et=a(119),tt=a.n(et),at=(a(159),Object(n.memo)((function(e){var t=e.sender,a=e.roomID,c=e.audioUrl,r=e.id,o=e.setAudioID,s=e.audioID,l=e.animState,h=e.audioPlayed,j=Object(n.useState)(!1),m=Object(i.a)(j,2),g=m[0],b=m[1],f=Object(n.useState)(!1),O=Object(i.a)(f,2),v=O[0],x=O[1],w=Object(n.useState)(!1),y=Object(i.a)(w,2),S=y[0],I=y[1],D=Object(n.useState)(!1),L=Object(i.a)(D,2),N=L[0],R=L[1],k=Object(n.useState)(!1),M=Object(i.a)(k,2),C=M[0],E=M[1],U=Object(n.useState)(0),T=Object(i.a)(U,2),P=T[0],H=T[1],A=Object(n.useState)("0%"),F=Object(i.a)(A,2),W=F[0],q=F[1],B=Object(n.useState)(""),z=Object(i.a)(B,2),G=z[0],Y=z[1],X=Object(n.useRef)(""),V=Object(n.useRef)(new Audio(c)),J=Object(n.useRef)(),K=Object(n.useRef)("uploading"===c);function Z(){var e=0;isNaN(V.current.duration)||(e=V.current.currentTime*(100/V.current.duration),H(e),q(e+"%"),Y(function(){var e=Math.floor(V.current.currentTime/60),t=Math.floor(V.current.currentTime-60*e);return t<10&&(t="0"+t),e<10&&(e="0"+e),e+":"+t}()))}return Object(n.useEffect)((function(){!0===K.current&&"uploading"!==c?(V.current=new Audio(c),V.current.load(),I(!0)):!1===K.current&&I(!0)}),[c]),Object(n.useEffect)((function(){var e;S&&(V.current.addEventListener("error",(function(){E(!0)})),(e=V.current,new Promise((function(t,a){e.onloadedmetadata=function(){e.currentTime=Number.MAX_SAFE_INTEGER,e.ontimeupdate=function(){e.ontimeupdate=function(){},e.currentTime=.1,e.currentTime=0,t(e.duration)}}}))).then((function(){R(!0)})))}),[S]),Object(n.useEffect)((function(){N&&(V.current.addEventListener("canplaythrough",Object(d.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:""===X.current&&(x(!0),t=Math.floor(V.current.duration/60),(a=Math.floor(V.current.duration-60*t))<10&&(a="0"+a),t<10&&(t="0"+t),X.current=t+":"+a,Y(X.current));case 1:case"end":return e.stop()}}),e)})))),V.current.addEventListener("ended",(function(){clearInterval(J.current),Y(X.current),H(0),q("0%"),b(!1)})))}),[N]),Object(n.useEffect)((function(){"exiting"===l&&V.current.pause()}),[l]),Object(n.useEffect)((function(){s!==r&&(V.current.pause(),b(!1))}),[s]),Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)("div",{className:"".concat(t?"audioplayer":"audioplayer audioplayer2"," ").concat(h?"audioplayer__played":""),children:[v||C?g&&!C?Object(_.jsx)(Qe.a,{className:"pause",onClick:function(){V.current.pause(),clearInterval(J.current),b(!1),Y(X.current)}}):g||C?Object(_.jsx)(tt.a,{onClick:function(){V.current.load(),E(!1)}}):Object(_.jsx)(Ze.a,{onClick:function(){V.current.play(),h||t||_e.collection("rooms").doc(a).collection("messages").doc(r).set({audioPlayed:!0},{merge:!0}),s!==r&&o(r),J.current=setInterval(Z,50),b(!0)}}):Object(_.jsx)(p.a,{}),Object(_.jsxs)("div",{children:[Object(_.jsx)("span",{style:{width:W},className:"audioplayer__slider--played"}),Object(_.jsx)("input",{type:"range",min:"1",max:"100",value:P,onChange:function(e){var t=e.target.value;if(v){var a=V.current.duration*(t/100);V.current.currentTime=a,H(t),q("".concat(t-t/100*5.7,"%"))}},className:"audioplayer__slider"})]})]}),Object(_.jsx)("span",{className:"chat__timestamp audioplayer__time",children:G})]})}))),nt=(a(160),a.p+"static/media/message_sent.3957aabd.mp3"),ct=a.p+"static/media/message_received.7170470c.mp3",rt=a(234),ot=a(235),st=a(236);function it(e){var t,a,c,r,o=e.animState,l=e.unreadMessages,j=e.b,m=Object(n.useState)(""),g=Object(i.a)(m,2),b=g[0],x=g[1],w=Object(B.i)().roomID,y=Object(B.h)(),S=Object(B.j)(),I=L(),D=Object(i.a)(I,3),N=D[0],R=N.dispatchMessages,M=N.user,C=N.roomsData,E=N.page,U=D[1],T=D[2],P=Object(n.useState)({}),H=Object(i.a)(P,2),A=H[0],F=H[1],W=Object(n.useState)([]),q=Object(i.a)(W,2),z=q[0],X=q[1],V=Object(n.useState)(null),J=Object(i.a)(V,2),K=J[0],Z=J[1],$=Object(n.useState)(!1),Q=Object(i.a)($,2),ee=Q[0],te=Q[1],ae=Object(n.useState)(!1),ne=Object(i.a)(ae,2),ce=ne[0],re=ne[1],oe=Object(n.useState)(""),se=Object(i.a)(oe,2),ie=se[0],le=se[1],ue=Object(n.useState)(y.state?y.state:{}),de=Object(i.a)(ue,2),he=de[0],je=de[1],me=Object(n.useState)(!1),ge=Object(i.a)(me,2),fe=ge[0],Oe=ge[1],ve=Object(n.useState)(!1),ye=Object(i.a)(ve,2),Ie=ye[0],De=ye[1],Te=Object(n.useState)(""),Pe=Object(i.a)(Te,2),Fe=Pe[0],We=Pe[1],qe=Object(n.useState)(null),ze=Object(i.a)(qe,2),Ge=ze[0],Xe=ze[1],Ke=Object(n.useState)(0),Ze=Object(i.a)(Ke,2),$e=Ze[0],Qe=Ze[1],et=Object(n.useState)(!1),tt=Object(i.a)(et,2),it=tt[0],lt=tt[1],ut=Object(n.useState)(!1),dt=Object(i.a)(ut,2),ht=dt[0],jt=dt[1],mt=Object(n.useState)(null),gt=Object(i.a)(mt,2),bt=gt[0],ft=gt[1],pt=Object(n.useState)(!1),Ot=Object(i.a)(pt,2),vt=Ot[0],xt=Ot[1],wt=Object(n.useState)(!1),yt=Object(i.a)(wt,2),St=yt[0],_t=yt[1],It=Object(n.useState)(Boolean(null===(t=R[w])||void 0===t?void 0:t.limitReached)),Dt=Object(i.a)(It,2),Lt=Dt[0],Nt=Dt[1],Rt=Object(B.g)(),kt=Object(n.useRef)(),Mt=Object(n.useRef)(),Ct=Object(n.useRef)(),Et=Object(n.useRef)(),Ut=Object(n.useRef)(),Tt=Object(n.useRef)([]),Pt=Object(n.useRef)(30),Ht=Object(n.useRef)(null),At=Object(n.useState)(null),Ft=Object(i.a)(At,2),Wt=Ft[0],qt=Ft[1],Bt=Object(n.useRef)(null),zt=Object(n.useRef)(null),Gt=Object(n.useState)(!1),Yt=Object(i.a)(Gt,2),Xt=Yt[0],Vt=Yt[1],Jt=new Audio(nt),Kt=new Audio(ct),Zt=Object(n.useRef)([]),$t=Object(n.useRef)(!1),Qt=function(){Ut.current.style.animation="opacity-out 300ms ease forwards",setTimeout((function(){Xe(null),We("")}),310)};function ea(e){if(e){var t=e.offsetHeight,a=getComputedStyle(e);return t+=parseInt(a.marginTop)+parseInt(a.marginBottom)}return null}var ta=function(){var e=Object(d.a)(u.a.mark((function e(t){var a,n,c,r,o,s,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),ce&&document.querySelector(".chat__footer > form > input").focus(),!(""!==b||""===b&&Ge)){e.next=16;break}return a=b,(n=Ge)&&Qt(),x(""),c={lastMessage:n?{message:a,audio:!1}:a,seen:!1},_e.collection("rooms").doc(w).set(c,{merge:!0}),n&&(r=n.name.split("."),o=r[0]+Object(Be.a)()+"."+r[1]),s=n?{name:M.displayName,message:b,uid:M.uid,timestamp:pe(),time:(new Date).toLocaleString("ru",{year:"numeric",month:"long",day:"numeric",weekday:"long",timezone:"UTC",hour:"numeric",minute:"numeric"}),imageUrl:"uploading",imageName:o,ratio:it}:{name:M.displayName,message:b,uid:M.uid,timestamp:pe(),time:(new Date).toLocaleString("ru",{year:"numeric",month:"long",day:"numeric",weekday:"long",timezone:"UTC",hour:"numeric",minute:"numeric"})},he.userID?(_e.collection("users").doc(he.userID).collection("chats").doc(w).set({timestamp:pe(),photoURL:M.photoURL?M.photoURL:null,name:M.displayName,userID:M.uid,unreadMessages:xe(1)},{merge:!0}),_e.collection("users").doc(M.uid).collection("chats").doc(w).set({timestamp:pe(),photoURL:he.photoURL?he.photoURL:null,name:he.name,userID:he.userID},{merge:!0}),""===ie||n||_e.collection("notifications").add({userID:M.uid,title:M.displayName,body:a,photoURL:M.photoURL,token:ie})):_e.collection("users").doc(M.uid).collection("chats").doc(w).set({timestamp:pe(),photoURL:he.photoURL?he.photoURL:null,name:he.name}),e.next=14,_e.collection("rooms").doc(w).collection("messages").add(s);case 14:i=e.sent,n&&new Ve.a(n,{quality:.8,maxWidth:1920,success:function(e){return Object(d.a)(u.a.mark((function t(){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return We(""),Xe(null),t.next=4,we.child(o).put(e);case 4:return t.next=6,we.child(o).getDownloadURL();case 6:n=t.sent,_e.collection("rooms").doc(w).collection("messages").doc(i.id).update({imageUrl:n}),he.userID&&""!==ie&&_e.collection("notifications").add({userID:M.uid,title:M.displayName,body:a,photoURL:M.photoURL,token:ie,image:n});case 9:case"end":return t.stop()}}),t)})))()}});case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),aa=function(){var e=Object(d.a)(u.a.mark((function e(){var t,a,n,c,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.navigator.onLine){e.next=24;break}return Z(!1),te(!0),e.prev=3,t=_e.collection("rooms").doc(w),e.next=7,t.collection("messages").get();case 7:return a=e.sent,n=[],c=[],a.docs.forEach((function(e){e.data().audioName?n.push(e.data().audioName):e.data().imageName&&c.push(e.data().imageName)})),r=[],r=he.userID?[he.userID,M.uid]:Object(O.a)(new Set(a.docs.map((function(e){return e.data().uid})))),e.next=15,Promise.all([].concat(Object(O.a)(a.docs.map((function(e){return e.ref.delete()}))),Object(O.a)(c.map((function(e){return we.child(e).delete()}))),Object(O.a)(n.map((function(e){return Se.child(e).delete()}))),Object(O.a)(r.map((function(e){return _e.collection("users").doc(e).collection("chats").doc(w).delete()}))),[t.delete()]));case 15:E.width<=160?Rt.goBack():Rt.replace("/chats"),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(3),console.log(e.t0.message),E.width<=160?Rt.goBack():Rt.replace("/chats");case 22:e.next=25;break;case 24:alert("\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u043e\u043c!!!");case 25:case"end":return e.stop()}}),e,null,[[3,18]])})));return function(){return e.apply(this,arguments)}}();function na(e){var t=_e.collection("rooms").doc(w).collection("messages").orderBy("timestamp","desc");e?j.current[w]=t.limit(5).onSnapshot((function(t){var a=t.docs.map((function(e){var t,a=e.data(),n=a.time?a.time:new Date(null===(t=a.timestamp)||void 0===t?void 0:t.toDate()).toUTCString();return Object(s.a)(Object(s.a)({},a),{},{timestamp:n,id:e.id})}));a.reverse(),U({type:T.SET_MESSAGES,id:w,messages:a,update:e})})):t.limit(Pt.current).get().then((function(t){var a=[];t.forEach((function(e){var t,n=e.data(),c=n.time?n.time:new Date(null===(t=n.timestamp)||void 0===t?void 0:t.toDate()).toUTCString();a.push(Object(s.a)(Object(s.a)({},n),{},{timestamp:c,id:e.id}))})),a.reverse(),U({type:T.SET_MESSAGES,id:w,messages:a,update:e})}))}function ca(){var e;0!==(null===(e=Ct.current)||void 0===e?void 0:e.scrollTop)||Lt||Bt.current?zt.current&&(Ht.current=Ct.current.scrollHeight-Ct.current.scrollTop):(Vt(!0),Ht.current=Ct.current.scrollHeight,Bt.current=!0,zt.current=!0,Pt.current=z.length+Pt.current,na(!1))}function ra(e){return _e.collection("rooms").doc(w).collection("messages").doc(e).onSnapshot((function(t){var a=t.data().imageUrl;"uploading"!==a&&(U({type:"update_media",roomID:w,id:e,data:{imageUrl:a}}),Zt.current=Zt.current.filter((function(t){return t.id!==e||(t.snap(),!1)})))}))}function oa(e){return _e.collection("rooms").doc(w).collection("messages").doc(e).onSnapshot((function(t){var a=t.data(),n=a.audioUrl,c=a.audioPlayed;"uploading"===n&&!0!==c||U({type:"update_media",roomID:w,id:e,data:{audioUrl:n,audioPlayed:c}}),"uploading"!==n&&!0===c&&(Zt.current=Zt.current.filter((function(t){return t.id!==e||(t.snap(),!1)})))}))}Object(n.useEffect)((function(){var e,t,a;z.length>0&&!ee&&(z[z.length-1].id!==(null===(e=Tt.current[(null===(t=Tt.current)||void 0===t?void 0:t.length)-1])||void 0===e?void 0:e.id)&&(null===(a=R[w])||void 0===a?void 0:a.audio)&&(z[z.length-1].uid===M.uid||zt.current||"uploading"!==z[z.length-1].imageUrl&&z[z.length-1].imageUrl?z[z.length-1].uid!==M.uid||zt.current||"uploading"!==z[z.length-1].imageUrl&&z[z.length-1].imageUrl||"uploading"!==z[z.length-1].audioUrl&&z[z.length-1].audioUrl||Jt.play():Kt.play()))}),[z,ee,R[w]]),Object(n.useEffect)((function(){vt&&!Lt&&Ct.current.addEventListener("scroll",ca);var e=Ct.current;return function(){e.removeEventListener("scroll",ca)}}),[vt,Lt]),Object(n.useEffect)((function(){var e,t;Lt!==(null===(e=R[w])||void 0===e?void 0:e.limitReached)&&Nt(Boolean(null===(t=R[w])||void 0===t?void 0:t.limitReached))}),[R[w]],Lt),Object(n.useLayoutEffect)((function(){var e;z.length>0&&Bt.current&&(Bt.current&&z.length>(null===(e=Tt.current)||void 0===e?void 0:e.length)&&(Ct.current.scrollTop=Ct.current.scrollHeight-Ht.current,Bt.current=!1,Vt(!1)))}),[z]),Object(n.useEffect)((function(){z.length>0&&(vt||Ct.current.scrollHeight-Ct.current.offsetHeight===0?zt.current||function(){var e=Array.from(document.querySelectorAll(".chat__message")),t=ea(e[e.length-2])+ea(e[e.length-3])+ea(e[e.length-4]),a=t<E.height/2?t:E.height/2;Ct.current.scrollHeight-Ct.current.offsetHeight===0?(setTimeout((function(){kt.current&&(kt.current.style.opacity="1"),xt(!0)}),"entering"===o?350:50),setTimeout((function(){var e=document.querySelector(".chat .chat__lastMessage");e&&(e.style.animation="none",e.style.opacity="1")}),50)):Ct.current.scrollTop+ea(e[e.length-1])>=Ct.current.scrollHeight-Ct.current.offsetHeight-a&&z[z.length-1].uid!==M.uid||z[z.length-1].uid===M.uid?Ct.current.scrollTop!==Ct.current.scrollHeight&&(_t(!0),Object(Je.a)({targets:Ct.current,scrollTop:Ct.current.scrollHeight,duration:800,easing:"linear",complete:function(){_t(!1)}})):jt(!0)}():(Ct.current.scrollTop=Ct.current.scrollHeight,setTimeout((function(){var e=document.querySelector(".chat .chat__lastMessage");e&&(e.style.animation="none",e.style.opacity="1"),setTimeout((function(){xt(!0)}),200)}),50)))}),[z]),Object(n.useEffect)((function(){return function(){U({type:"set_audio_false",id:w})}}),[w]),Object(n.useEffect)((function(){if(z.length>0&&vt&&!$t.current)z.forEach((function(e){if("uploading"===e.imageUrl){var t=ra(e.id);Zt.current.push({snap:t,id:e.id})}else if("uploading"===e.audioUrl||!1===e.audioPlayed){var a=oa(e.id);Zt.current.push({snap:a,id:e.id})}})),$t.current=!0;else if(z.length>Tt.current.length&&vt&&$t.current){var e,t=0,a=z.length-Tt.length;(null===(e=Tt.current[0])||void 0===e?void 0:e.id)===z[0].id&&(t=Tt.current.length,a=z.length);for(var n=t;n<a;n++)if("uploading"===z[n].imageUrl){var c=ra(z[n].id);Zt.current.push({snap:c,id:z[n].id})}else if("uploading"===z[n].audioUrl||!1===z[n].audioPlayed){var r=oa(z[n].id);Zt.current.push({snap:r,id:z[n].id})}}}),[z,vt]),Object(n.useEffect)((function(){return function(){Zt.current.forEach((function(e){return e.snap()})),xt(!1)}}),[w]),Object(n.useEffect)((function(){zt.current=Bt.current,Tt.current=Object(O.a)(z)}),[z]),Object(n.useEffect)((function(){var e;w&&!ee&&(j.current[w]&&j.current[w](),(null===(e=R[w])||void 0===e?void 0:e.firstMessageID)?na(!0):_e.collection("rooms").doc(w).collection("messages").orderBy("timestamp","asc").limit(1).get().then((function(e){e.empty?U({type:"set_firstMessage",id:w,firstMessageID:"no id"}):e.forEach((function(e){U({type:"set_firstMessage",id:w,firstMessageID:e.id})})),na(!1),na(!0)})))}),[w,ee]),Object(n.useEffect)((function(){if(""!==Fe){var e=document.querySelector(".mediaPreview img").clientWidth,t=document.querySelector(".mediaPreview img").clientHeight;lt(t/e)}}),[Fe]),Object(n.useEffect)((function(){ft(document.querySelector(".chat__body--container").clientWidth)}),[]),Object(n.useEffect)((function(){"entering"===o&&E.width<=160?setTimeout((function(){document.querySelector(".chat").classList.add("chat-animate")}),0):"entered"===o&&(null===he||void 0===he?void 0:he.name)&&E.width<=760?setTimeout((function(){document.querySelector(".sidebar").classList.remove("side")}),50):"exiting"===o&&E.width<=160&&setTimeout((function(){document.querySelector(".chat").classList.remove("chat-animate"),setTimeout((function(){document.querySelector(".sidebar").classList.add("side")}),10)}),0)}),[o]),Object(n.useEffect)((function(){if(!y.state&&w){var e=null===w||void 0===w?void 0:w.replace(M.uid,"");_e.collection("users").doc(e).get().then((function(t){var a=t.data();je((null===a||void 0===a?void 0:a.name)?{name:a.name,photoURL:a.photoURL,userID:e}:{userID:e})}))}else je(y.state)}),[y.state,w]),Object(n.useEffect)((function(){(null===he||void 0===he?void 0:he.userID)&&_e.collection("users").doc(he.userID).onSnapshot((function(e){var t;(null===(t=e.data())||void 0===t?void 0:t.token)&&le(e.data().token)}))}),[he]),Object(n.useEffect)((function(){if(w&&(null===he||void 0===he?void 0:he.userID))var e=_e.collection("rooms").doc(w).onSnapshot((function(e){e.data()&&De(e.data()[he.userID])}));return function(){e&&e()}}),[w,he]),Object(n.useEffect)((function(){if(w)var e=_e.collection("rooms").doc(w).onSnapshot((function(e){var t;Oe(null===(t=e.data())||void 0===t?void 0:t.seen)}));return function(){e&&e()}}),[w]),Object(n.useEffect)((function(){var e=function(){var e,t,a,n=Array.from(document.querySelectorAll(".chat__message")),c=ea(n[n.length-1])+ea(n[n.length-2])+ea(n[n.length-3])+ea(n[n.length-4]),r=c<E.height/2?c:E.height/2;(null===(e=Ct.current)||void 0===e?void 0:e.scrollTop)<=(null===(t=Ct.current)||void 0===t?void 0:t.scrollHeight)-(null===(a=Ct.current)||void 0===a?void 0:a.offsetHeight)-r?jt(!0):jt(!1);var s=Math.round(Ct.current.scrollTop),i=Ct.current.scrollHeight-Ct.current.offsetHeight;s!==i&&s+1!==i&&s-1!==i||"0"!==kt.current.style.opacity&&""!==kt.current.style.opacity||setTimeout((function(){kt.current&&(kt.current.style.opacity="1")}),"entering"===o?350:50),z.length>0&&(Ct.current.scrollTop>Ct.current.scrollHeight-Ct.current.offsetHeight-180&&he.userID&&!fe&&z[z.length-1].uid!==M.uid&&(console.log("setting seen true with event"),_e.collection("rooms").doc(w).set({seen:!0},{merge:!0})),Ct.current.scrollTop>Ct.current.scrollHeight-Ct.current.offsetHeight-180&&he.userID&&_e.collection("users").doc(M.uid).collection("chats").doc(w).set({unreadMessages:0},{merge:!0}))};Ct.current.addEventListener("scroll",e);var t=Ct.current;return function(){t.removeEventListener("scroll",e)}}),[z,he,M.uid,w,fe]),Object(n.useEffect)((function(){z.length>0&&Ct.current.scrollHeight-Ct.current.offsetHeight===0&&z[z.length-1].uid!==M.uid&&_e.collection("rooms").doc(w).set({seen:!0},{merge:!0})}),[z]),Object(n.useEffect)((function(){z.length>0&&Ct.current.scrollHeight-Ct.current.offsetHeight===0&&he.userID&&_e.collection("users").doc(M.uid).collection("chats").doc(w).set({unreadMessages:0},{merge:!0})}),[z,he]),Object(n.useEffect)((function(){var e;(null===(e=R[w])||void 0===e?void 0:e.messages)&&X(R[w].messages)}),[R[w]]);var sa=.7;return Object(_.jsxs)(_.Fragment,{children:[Object(_.jsxs)("div",{style:w?{}:{display:"none"},ref:Et,className:"chat",children:[Object(_.jsx)("div",{style:{height:E.height},className:"chat__background"}),Object(_.jsxs)("div",{className:"chat__header",children:[E.width<=760?Object(_.jsxs)(k.a,{onClick:function(){return setTimeout((function(){return Rt.goBack()}),150)},children:[Object(_.jsx)(ke.a,{}),Object(_.jsxs)("div",{className:"avatar__container",children:[Object(_.jsx)(h.a,{src:null===he||void 0===he?void 0:he.photoURL}),"online"===(null===(a=C[w])||void 0===a?void 0:a.onlineState)?Object(_.jsx)("div",{className:"online"}):null]})]}):Object(_.jsxs)("div",{className:"avatar__container",children:[Object(_.jsx)(h.a,{src:null===he||void 0===he?void 0:he.photoURL}),"online"===(null===(c=C[w])||void 0===c?void 0:c.onlineState)?Object(_.jsx)("div",{className:"online"}):null]}),Object(_.jsxs)("div",{className:"chat__header--info",children:[Object(_.jsxs)("h3",{style:E.width<=160?{width:E.width-265}:{},children:[null===he||void 0===he?void 0:he.name," ",null===he||void 0===he?void 0:he.about," ",null===he||void 0===he?void 0:he.phone]}),Object(_.jsxs)("p",{style:E.width<=160?{width:E.width-165}:{},children:["recording"===Ie?"\u0417\u0430\u043f\u0438\u0441\u044b\u0432\u0430\u0435\u0442\u0441\u044f ...":Ie?"\u041f\u0438\u0448\u0435\u0442 ...":(null===z||void 0===z?void 0:z.length)>0?"\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e "+(null===(r=z[z.length-1])||void 0===r?void 0:r.timestamp):""," "]})]}),Object(_.jsxs)("div",{className:"chat__header--right",children:[Object(_.jsx)("input",{id:"attach-media",style:{display:"none"},accept:"image/*",type:"file",onChange:function(e){if(window.navigator.onLine){if(e.target.files[0]){var t=new FileReader;t.onload=function(){We(t.result)},t.readAsDataURL(e.target.files[0]),Xe(e.target.files[0])}}else alert("\u041d\u0435\u0442 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f \u043a \u0438\u043d\u0442\u0435\u0440\u043d\u0435\u0442\u0443!")}}),Object(_.jsx)(k.a,{children:Object(_.jsx)("label",{style:{cursor:"pointer",height:24},htmlFor:"attach-media",children:Object(_.jsx)(Me.a,{})})}),Object(_.jsx)(k.a,{"aria-controls":"menu","aria-haspopup":"true",onClick:function(e){return Z(e.currentTarget)},children:Object(_.jsx)(Ce.a,{})}),Object(_.jsxs)(G.a,{anchorEl:K,id:"menu",open:Boolean(K),onClose:function(){return Z(null)},keepMounted:!0,children:[Object(_.jsxs)(Y.a,{onClick:aa,children:[Object(_.jsx)(rt.a,{})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u0441\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f"]}),Object(_.jsxs)(Y.a,{onClick:function(){be.signOut(),_e.doc("/users/"+M.uid).set({state:"offline"},{merge:!0}),Rt.replace("/chats"),setTimeout((function(){window.location.reload()}),1e3)},children:[Object(_.jsx)(ot.a,{})," \u0412\u044b\u0439\u0442\u0438"]}),Object(_.jsxs)(Y.a,{onClick:function(){be.signOut(),_e.doc("/users/"+M.uid).set({state:"offline"},{merge:!0}),Rt.replace("/chats"),setTimeout((function(){window.location.reload()}),1e3)},children:[Object(_.jsx)(st.a,{})," \u0412\u044b\u0439\u0442\u0438 \u0432 \u043e\u0444\u0444\u043b\u0430\u0439\u043d"]})]})]})]}),Object(_.jsx)("div",{className:"chat__body--container",ref:Ct,children:Object(_.jsxs)("div",{className:"chat__body",ref:kt,children:[Object(_.jsx)("div",{className:"loader__container paginateLoader",style:{height:Lt?30:70},children:Xt&&!Lt?Object(_.jsx)(p.a,{}):null}),z.map((function(e,t,a){var n=(e.imageUrl,{marginBottom:a[t+1]?e.uid!==a[t+1].uid?30:8:0,width:bt*sa+20,maxWidth:320});return Object(_.jsxs)("div",{style:n,ref:t!==z.length-1||fe&&z[z.length-1].uid===M.uid?null:Mt,className:"chat__message ".concat(e.uid===M.uid&&"chat__reciever"," ").concat(t===z.length-1?"chat__lastMessage":""),children:[Object(_.jsx)("span",{className:"chat__name",children:e.name}),"uploading"===e.imageUrl?Object(_.jsx)("div",{style:{width:bt*sa,height:e.ratio<=1?bt*sa>300?300*e.ratio:bt*sa*e.ratio:bt*sa<300?bt*sa:300},className:"image-container",children:Object(_.jsx)("div",{className:"image__container--loader",children:Object(_.jsx)(p.a,{style:{width:E.width<=760?40:80,height:E.width<=760?40:80}})})}):e.imageUrl?Object(_.jsx)("div",{className:"image-container",style:{width:bt*sa,height:e.ratio<=1?bt*sa>300?300*e.ratio:bt*sa*e.ratio:bt*sa<300?bt*sa:300},children:Object(_.jsx)(f.b,{to:{pathname:S.url+"/image",state:he},children:Object(_.jsx)("img",{onClick:function(t){return function(e,t,a){var n=e.target,c=n.parentNode.parentNode,r=c.getBoundingClientRect();F({ratio:a,top:"scale(1)"===E.transform?r.top:r.top/(window.innerHeight/E.height),left:"scale(1)"===E.transform?r.left:r.left/(window.innerWidth/E.width),width:c.offsetWidth,height:c.offsetHeight,imgW:n.offsetWidth,imgH:n.offsetHeight,src:t})}(t,e.imageUrl,e.ratio)},src:e.imageUrl,alt:""})})}):null,e.audioName?Object(_.jsx)(at,{sender:e.uid===M.uid,roomID:w,animState:o,setAudioID:qt,audioID:Wt,id:e.id,audioUrl:e.audioUrl,audioPlayed:e.audioPlayed}):Object(_.jsx)("span",{className:"chat__message--message",children:e.message}),Object(_.jsx)("span",{className:"chat__timestamp",children:e.timestamp})]},e.id)})),z.length>0?Object(_.jsx)(Le.a,{in:fe&&z[z.length-1].uid===M.uid,timeout:200,classNames:"seen-animate",appear:!0,children:Object(_.jsx)("p",{className:"seen",children:Object(_.jsx)("p",{children:Object(_.jsxs)("span",{children:["\u041f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e ",Object(_.jsx)(Ee.a,{})]})})})}):null]})}),""!==Fe?Object(_.jsx)(He,{close:Qt,mediaPreview:Ut,setSRC:We,setImage:Xe,imageSRC:Fe}):null,Object(_.jsx)(Ye,{input:b,handleFocus:function(){Ct.current.scrollTop>Ct.current.scrollHeight-Ct.current.offsetHeight-120&&(Ct.current.scrollTop=Ct.current.scrollHeight)},change:function(e){clearTimeout($e),x(e.target.value),(null===he||void 0===he?void 0:he.userID)&&_e.collection("rooms").doc(w).set(Object(v.a)({},M.uid,!0),{merge:!0}).then((function(){Qe(setTimeout((function(){_e.collection("rooms").doc(w).set(Object(v.a)({},M.uid,!1),{merge:!0})}),1e3))}))},sendMessage:ta,setFocus:re,image:Ge,focus:ce,state:he,token:ie,roomID:w,setAudioID:qt}),Object(_.jsx)("div",{}),Object(_.jsx)(Le.a,{in:vt&&ht&&!St,classNames:"scroll",timeout:310,unmountOnExit:!0,children:Object(_.jsxs)("div",{className:"scroll",onClick:function(){return Object(Je.a)({targets:Ct.current,scrollTop:Ct.current.scrollHeight,duration:1e3,easing:"linear"})},children:[Object(_.jsx)(Ue.a,{style:{width:22,height:22,color:"black"}}),l?Object(_.jsx)("div",{children:Object(_.jsx)("span",{children:l})}):null]})}),ee?Object(_.jsx)("div",{className:"chat__deleting",children:Object(_.jsx)(p.a,{})}):null]}),Object(_.jsx)(Ne.a,{component:null,children:Object(_.jsx)(Re.a,{timeout:{appear:310,enter:310,exit:410},classNames:"page",children:function(e){return Object(_.jsx)(B.b,{path:S.url+"/image",location:y,children:Object(_.jsx)(Ae,{imagePreview:A,animState:e})})}},y.pathname)})]})}var lt=Object(n.memo)(it);a(161);function ut(){return Object(_.jsxs)("div",{className:"login",children:[Object(_.jsxs)("div",{className:"nono",children:[" ",Object(_.jsx)(H,{})]}),Object(_.jsxs)("div",{className:"login__container",children:[Object(_.jsx)("img",{src:"/logo.png",alt:"UberClone"}),Object(_.jsx)("div",{className:"login__text",children:Object(_.jsx)("h1",{children:"\u0412\u043e\u0439\u0434\u0438\u0442\u0435 \u0432 UberClone"})}),Object(_.jsx)(M.a,{onClick:function(){be.signInWithRedirect(fe).catch((function(e){return alert(e.message)}))},children:"\u0432\u043c\u0435\u0441\u0442\u0435 \u0441 \u0413\u0443\u0433\u043b"})]})]})}var dt=Object(n.memo)(ut);function ht(e,t,a,c,r){var o=Object(n.useRef)(0),s=Object(n.useRef)(),l=Object(n.useState)(null),u=Object(i.a)(l,2),d=u[0],h=u[1],j=Object(n.useRef)(0);return[d,function n(i){if(o.current||0===o.current){"limit attended"===o.current?(i(!1),o.current=null):(i(!0),o.current=o.current+e),s.current&&s.current(),a&&(j.current=0);var l=null,u=o.current?t.limit(o.current):t;s.current=u.onSnapshot((function(e){var t,a;j.current++;var s=function(){var t=c(e);h(t),i(!1),("users"===r&&t.length<o.current-1||"users"!==r&&t.length<o.current)&&(o.current="limit attended",n(i))};(null===(t=e.docs)||void 0===t?void 0:t.length)>0?j.current>=2?(l&&(clearTimeout(l),l=null),s()):l=setTimeout(s,1500):0===(null===(a=e.docs)||void 0===a?void 0:a.length)&&(h([]),i(!1))}))}return s},h]}a(89);var jt=a(53),mt=(a(239),a(240),Object(te.a)((function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}}})),void 0),gt={suppressMapOpenBlock:!0};navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,a=e.coords.longitude,n=t+", "+a;localStorage.setItem("lat",t),localStorage.setItem("lng",a),localStorage.setItem("gps",n);var c=e.coords.accuracy;localStorage.setItem("accuracy",c)}));var bt=localStorage.getItem("lat"),ft=localStorage.getItem("lng"),pt=localStorage.getItem("gps"),Ot={center:[bt,ft],zoom:12};console.log("gps DestinationSearch "+pt);var vt=function(e){var t=Object(B.g)();console.log("props",e);var a=Object(n.useState)(!1),r=Object(i.a)(a,2),o=r[0],s=r[1],l=Object(n.useState)("0.5"),u=Object(i.a)(l,2),d=u[0],h=u[1],j=Object(n.useState)("invert(1)"),m=Object(i.a)(j,2),g=m[0],b=m[1],f=c.a.useState(!1),p=Object(i.a)(f,2),O=p[0];p[1];console.log(d);Object(n.useState)(null);null===localStorage.getItem("userName")&&localStorage.setItem("userName"," \u0437\u0430\u043b\u043e\u0433\u0438\u043d\u044c\u0442\u0435\u0441\u044c");var v=Object(n.useState)([]),x=Object(i.a)(v,2),w=(x[0],x[1],Object(n.useState)(e.users)),y=Object(i.a)(w,2),S=y[0];y[1];console.log("props.users",e.users);var I=Object(n.useState)([]),D=Object(i.a)(I,2);D[0],D[1];return Object(_.jsxs)("div",{className:"dest",children:[Object(_.jsxs)("div",{className:"destb",style:{opacity:d,filter:g},children:[Object(_.jsx)(de,{drawerLeft:o,setDrawerLeft:s,db:_e,auth:be,storage:ye}),Object(_.jsx)(jt.e,{className:"destYMaps",query:{apikey:"77344b8e-1d6e-4ba9-be6c-dfe62831be7a"},children:Object(_.jsxs)(jt.b,{className:"destMap",options:gt,modules:["templateLayoutFactory","layout.ImageWithContent"],state:Ot,onApiAvaliable:function(e){return mt.onApiAvaliable(e)},children:[Object(_.jsx)(jt.d,{instanceRef:function(e){if(e){e.routePanel.state.set({from:"",to:"",type:"auto"});var t=e.routePanel.getRouteAsync();t.then((function(e){return e.model.events.add("requestsuccess",(function(){var t=e.getActiveRoute();if(t){t.getPaths().each((function(e){var t=e.getSegments();console.log(t);var a="";t.each((function(e){console.log(" \u041c\u0430\u043d\u0435\u0432\u0440 \u0432 \u043a\u043e\u043d\u0446\u0435 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430: "+e.properties.get("action").text),a+=" \u041c\u0430\u043d\u0435\u0432\u0440 \u0432 \u043a\u043e\u043d\u0446\u0435 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430: "+e.properties.get("action").text,console.log(" \u0414\u043b\u0438\u043d\u0430 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430: "+e.properties.get("distance").text),a+=" \u0414\u043b\u0438\u043d\u0430 \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430: "+e.properties.get("distance").text,console.log(" \u0412\u0440\u0435\u043c\u044f \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430: "+e.properties.get("duration").text),a+=" \u0412\u0440\u0435\u043c\u044f \u043f\u0440\u043e\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u044f \u0441\u0435\u0433\u043c\u0435\u043d\u0442\u0430: "+e.properties.get("duration").text,console.log(" \u041f\u043e \u043a\u0430\u043a\u043e\u0439 \u0443\u043b\u0438\u0446\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442 \u0441\u0435\u0433\u043c\u0435\u043d\u0442: "+e.properties.get("street")),a+=" \u041f\u043e \u043a\u0430\u043a\u043e\u0439 \u0443\u043b\u0438\u0446\u0435 \u043f\u0440\u043e\u0445\u043e\u0434\u0438\u0442 \u0441\u0435\u0433\u043c\u0435\u043d\u0442: "+e.properties.get("street")})),console.log("obje",a),localStorage.setItem("obje",a)}));var a=t.properties.get("distance").text;console.log("\u0414\u043b\u0438\u043d\u0430 \u043c\u0430\u0440\u0448\u0440\u0443\u0442\u0430: ",a),console.log("\u041f\u0440\u0438\u043c\u0435\u0440\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043f\u0440\u043e\u0435\u0437\u0434\u0430: "+t.properties.get("duration").text),localStorage.setItem("distanceValue",t.properties.get("distance").value),localStorage.setItem("distance","\u0420\u0430\u0441\u0441\u0442\u043e\u044f\u043d\u0438\u0435: "+t.properties.get("distance").text),localStorage.setItem("duration","\u041f\u0440\u0438\u043c\u0435\u0440\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043f\u0440\u043e\u0435\u0437\u0434\u0430: "+t.properties.get("duration").text),console.log(a)}})),e})).then((function(){return t})).catch(console.log.bind(console))}},options:{float:"right",size:"large",popupWidth:"210px",maxWidth:"210px"},state:{popupWidth:"210px"}}),Object(_.jsx)(jt.a,{options:{float:"left"}}),Object(_.jsx)(jt.c,{style:{width:10,transform:[{rotate:"90deg"}]},geometry:{type:"Point",coordinates:[bt,ft]},properties:{hintContent:"\u044f",balloonContent:"\u044f",iconCaption:"\u044f",iconImageRotation:50},modules:["geoObject.addon.hint"]},"fdsdfsdfhghf654gfd"),null===S||void 0===S?void 0:S.map((function(e){return Object(_.jsx)(jt.c,{style:{width:10,transform:[{rotate:"90deg"}]},geometry:{type:"Point",coordinates:[e.latitude,e.longitude]},properties:{hintContent:e.name+" "+e.about,balloonContent:e.name+" "+e.about,iconCaption:e.name+" "+e.about,iconImageRotation:50},modules:["geoObject.addon.hint"],options:{iconLayout:"default#image",iconImageHref:e.photoURL,iconImageSize:[74,61],iconImageOffset:[-3,-42],iconImageRotation:50},onClick:function(a){localStorage.setItem("car.name ",e.name),localStorage.setItem("car.id ",e.userID),t.push("/room/"+e.userID)}},e.userID)}))]})})]}),Object(_.jsx)(M.a,{style:{backgroundColor:"grey",color:"white",padding:10,margin:10,alignItems:"center",cursor:"pointer"},disabled:O,variant:"outlined",onClick:function(){console.log("geo"),navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,a=e.coords.longitude,n=t+", "+a;localStorage.setItem("lat",t),localStorage.setItem("lng",a),localStorage.setItem("gps",n);var c=e.coords.accuracy;localStorage.setItem("accuracy",c)}))},children:"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u0435 \u0433\u0435\u043e\u043b\u043e\u043a\u0430\u0446\u0438\u044e \u0434\u043b\u044f \u043c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u043e \u0442\u043e\u0447\u043d\u043e\u0433\u043e \u043f\u043e\u0438\u0441\u043a\u0430"}),Object(_.jsx)(M.a,{style:{backgroundColor:"black",color:"white",padding:10,margin:10,alignItems:"center",cursor:"pointer"},disabled:O,variant:"outlined",onClick:function(){s(!0)},children:"\u041e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0437\u0430\u044f\u0432\u043a\u0443 \u0434\u043b\u044f \u0432\u0441\u0435\u0445"}),Object(_.jsx)(M.a,{style:{backgroundColor:"rgb(85 255 42)",color:"black",padding:10,margin:10,alignItems:"center",cursor:"pointer"},disabled:O,variant:"outlined",onClick:function(){h("1"),b("hue-rotate(45deg)")},children:"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u043d\u0430 \u043a\u0430\u0440\u0442\u0435"})]})};localStorage.setItem("gps","47.6758555, 38.0625965"),localStorage.setItem("gps_sum","85.6"),localStorage.setItem("lng","38.0625965"),localStorage.setItem("lat","47.6758555"),navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,a=e.coords.longitude,n=t+", "+a,c=t+a;localStorage.setItem("lat",t),localStorage.setItem("lng",a),localStorage.setItem("gps",n),localStorage.setItem("gps_sum",c);var r=e.coords.accuracy;localStorage.setItem("accuracy",r)}));function xt(){var e=L(),t=Object(i.a)(e,3),a=t[0],c=a.user,r=a.path,o=a.pathID,l=a.roomsData,u=a.page,d=t[1],h=t[2],j=Object(n.useState)(!0),m=Object(i.a)(j,2),g=m[0],b=m[1],f=Object(n.useState)(void 0),O=Object(i.a)(f,2),v=O[0],w=O[1],y=Object(n.useState)(!1),S=Object(i.a)(y,2),I=S[0],D=(S[1],Object(n.useState)(!0)),N=Object(i.a)(D,2),R=(N[0],N[1],Object(n.useState)(!1)),k=Object(i.a)(R,2),M=k[0],C=(k[1],Object(n.useState)(null)),E=Object(i.a)(C,2),U=E[0],T=E[1],P=Object(n.useState)(),H=Object(i.a)(P,2),A=H[0],F=H[1],W=Object(B.h)(),q=function(){var e=L(),t=Object(i.a)(e,2),a=t[0].roomsData,c=t[1],r=Object(n.useRef)(a);return Object(n.useEffect)((function(){r.current=a}),[a]),[function(e,t){if(!r.current[t]){var a=_e.collection("rooms").doc(t).onSnapshot((function(e){var a;c({type:"update_rooms_data",dataType:"lastMessage",data:null===(a=e.data())||void 0===a?void 0:a.lastMessage,roomID:t})})),n=_e.collection("users").doc(e).onSnapshot((function(e){var a;c({type:"update_rooms_data",dataType:"onlineState",data:null===(a=e.data())||void 0===a?void 0:a.state,roomID:t})}));c({type:"add_rooms_data",roomID:t,lastMessageListener:a,onlineStatelistener:n})}}]}(),z=Object(i.a)(q,1)[0],G=Object(n.useRef)([]),Y=["/rooms","/search","/users","/chats"],X=ht(30,_e.collection("rooms").orderBy("timestamp","desc"),!0,(function(e){return e.docs.map((function(e){return Object(s.a)({id:e.id},e.data())}))}),"rooms"),V=Object(i.a)(X,2),J=V[0],K=V[1],Z=ht(30,_e.collection("users").where("state","==","online"),!0,(function(e){var t=[];return e.docs.length>0&&e.docs.forEach((function(e){var a=e.id>c.uid?e.id+c.uid:c.uid+e.id;e.id!==c.uid&&(t.push(Object(s.a)(Object(s.a)({},e.data()),{},{id:a,userID:e.id})),z(e.id,a))})),t}),"users"),$=Object(i.a)(Z,2),Q=$[0],ee=$[1];return console.log(Q),Object(n.useEffect)((function(){be.onAuthStateChanged((function(e){if(e){d({type:h.SET_USER,user:e}),b(!1),"serviceWorker"in navigator&&"PushManager"in window&&(a=e.uid,ve.requestPermission().then((function(){return ve.getToken()})).then((function(e){_e.collection("users").doc(a).set({token:e},{merge:!0})})).catch((function(e){_e.collection("users").doc(a).set({token:""},{merge:!0})})));var t=_e.collection("users").doc(e.uid);t.get().then((function(a){var n=a.data();return n&&n.timestamp?t.set({name:e.displayName,photoURL:e.photoURL,role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},{merge:!0}):t.set({name:e.displayName,photoURL:e.photoURL,timestamp:pe(),role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},{merge:!0})}))}else d({type:h.SET_USER,user:null});var a}))}),[]),Object(n.useEffect)((function(){window.addEventListener("beforeinstallprompt",(function(e){e.preventDefault(),w(e)})),window.addEventListener("resize",(function(){d({type:"set_scale_page",page:x()})}))}),[]),Object(n.useEffect)((function(){c&&(_e.collection("users").doc(c.uid).collection("chats").orderBy("timestamp","desc").onSnapshot({includeMetadataChanges:!0},(function(e){var t;(null===(t=e.docs)||void 0===t?void 0:t.length)>0?(e.docChanges().forEach((function(e){"added"===e.type&&z(e.doc.data().userID,e.doc.id)})),(!e.metadata.fromCache||!window.navigator.onLine&&e.metadata.fromCache)&&T(e.docs.map((function(e){return Object(s.a)(Object(s.a)({},e.data()),{},{id:e.id})})))):T([])})),K((function(){return null})),ee((function(){return null})))}),[c]),Object(n.useEffect)((function(){(null===U||void 0===U?void 0:U.length)>0?U.every((function(e){var t;return null===(t=l[e.id])||void 0===t?void 0:t.lastMessage}))&&F(!0):0===(null===U||void 0===U?void 0:U.length)&&F(!0)}),[U,l]),Object(n.useEffect)((function(){var e;return c&&function(e){try{console.log(localStorage.getItem("gps_sum").substring(4,-4)),console.log(localStorage.getItem("gps_sum"));var t={state:"offline",last_changed:Oe,id:e,latitude:localStorage.getItem("lat"),longitude:localStorage.getItem("lng"),coord:localStorage.getItem("gps"),coord_sum:localStorage.getItem("gps_sum").substring(4,-4),role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},a={state:"online",last_changed:Oe,id:e,latitude:localStorage.getItem("lat"),longitude:localStorage.getItem("lng"),coord:localStorage.getItem("gps"),coord_sum:localStorage.getItem("gps_sum").substring(4,-4),role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},n=_e.doc("/users/"+e),c=ge.ref("/status/"+e),r={state:"offline",last_changed:pe(),latitude:localStorage.getItem("lat"),longitude:localStorage.getItem("lng"),coord:localStorage.getItem("gps"),coord_sum:localStorage.getItem("gps_sum").substring(4,-4),role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")},o={state:"online",last_changed:pe(),latitude:localStorage.getItem("lat"),longitude:localStorage.getItem("lng"),coord:localStorage.getItem("gps"),coord_sum:localStorage.getItem("gps_sum").substring(4,-4),role:localStorage.getItem("role"),searchrole:localStorage.getItem("searchrole")};ge.ref(".info/connected").on("value",(function(e){!1!==e.val()?c.onDisconnect().set(t).then((function(){c.set(a),n.set(o,{merge:!0})})):n.set(r,{merge:!0})}))}catch(s){console.log("error setting onlins status: ",s)}}(c.uid),function(){e}}),[c]),Object(n.useEffect)((function(){var e=W.pathname.replace("/room/","");Y.forEach((function(t){return e=e.replace(t,"")})),d({type:"set_path_id",id:e})}),[W.pathname]),Object(_.jsxs)("div",{className:"app",children:[u.width<=160?Object(_.jsx)(B.a,{to:"/chats"}):Object(_.jsx)(B.a,{to:"/"}),c||!g||I?c&&!I&&A?Object(_.jsxs)("div",{className:"app__body",children:[Object(_.jsx)(De,{chats:U,pwa:v,rooms:J,fetchRooms:K,users:Q,fetchUsers:ee}),Object(_.jsxs)(Ne.a,{component:null,children:[Object(_.jsx)(vt,{open:M,users:Q,fetchUsers:ee}),u.width<=760?Object(_.jsx)(Re.a,{timeout:260,children:function(e){var t;return Object(_.jsx)(B.b,{location:W,path:"".concat(r,"/room/:roomID"),children:Object(_.jsx)(lt,{b:G,unreadMessages:(null===U||void 0===U?void 0:U.length)>0?null===(t=U.find((function(e){return e.id===o})))||void 0===t?void 0:t.unreadMessages:0,animState:e})})}},W.pathname.replace("/image","")):Object(_.jsx)(Le.a,{timeout:1010,classNames:"page",children:function(e){var t;return Object(_.jsx)(B.b,{location:W,path:"".concat(r,"/room/:roomID"),children:Object(_.jsx)(lt,{b:G,unreadMessages:(null===U||void 0===U?void 0:U.length)>0?null===(t=U.find((function(e){return e.id===o})))||void 0===t?void 0:t.unreadMessages:0,animState:e})})}},W.pathname.replace("/image",""))]})]}):Object(_.jsx)("div",{className:"loader__container",children:Object(_.jsx)(p.a,{})}):Object(_.jsx)(dt,{})]})}var wt=Object(n.memo)(xt),yt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function St(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e){var t=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return t?new Promise((function(a,n){t.call(navigator,e,a,n)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),o.a.render(Object(_.jsx)(c.a.StrictMode,{children:Object(_.jsx)(f.a,{children:Object(_.jsx)(D,{initialState:w,reducer:S,children:Object(_.jsx)(wt,{})})})}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");yt?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):St(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):St(t,e)}))}}()},87:function(e,t,a){}},[[179,1,2]]]);
//# sourceMappingURL=main.ff1b867f.chunk.js.map